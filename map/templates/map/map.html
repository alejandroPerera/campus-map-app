{% extends "base.html" %}
{% load socialaccount %}
<!-- Redefine the title-->
{% block title %}Map{% endblock %}

{% block head %}
    <!-- MapBox map loads -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css' rel='stylesheet' />
{% endblock %}

{% block loads %}
    <!-- Mapbox Geocoder API loads-->
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css" type="text/css">
    <!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
{% endblock %}

{% block map %}
    <!-- From:https://docs.mapbox.com/mapbox-gl-js/api/ -->
    <div id='map'></div>
    <script>
        mapboxgl.accessToken = '{{ access_token }}';
        var resized = false;

        var map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/a-02/ckmb3agnj7w8i17qq9eqflzwj', // style URL
            center: {{ starting_coords }}, // starting position [lng, lat]
            zoom: 14, // starting zoom
            trackResize: true // Resize if the browser window size changes
        });


        // Fired after first load
        map.on('load', function() {
            map.resize();
            console.log('Map resized');
        });

        // Adds the search bar on the map
        map.addControl(
            new MapboxGeocoder({
                accessToken: mapboxgl.accessToken,
                mapboxgl: mapboxgl
            })
        );
    </script>
{% endblock %}

{% block schedule %}
    <h1>Schedule</h1>
    {% if user.is_authenticated %}
        <p>Welcome, {{ user.username }} !</p>
        <a href = "https://campusmapa-02.herokuapp.com/accounts/logout"> Click here to logout</a>
    {% endif %}
{% endblock %}

